<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Piano Ulang Tahun</title>
    <style>
      /* Reset dasar */
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      body {
        font-family: Arial, sans-serif;
        overflow-x: hidden;
        background: #f0f0f0;
      }
      /* Hero Section */
      .hero {
        height: 100vh;
        background: linear-gradient(135deg, #ff9a9e, #fad0c4);
        display: flex;
        justify-content: center;
        align-items: center;
        text-align: center;
        color: #fff;
        padding: 20px;
        flex-direction: column;
      }
      .hero h1 {
        font-size: 3rem;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
      }
      /* Piano Section */
      .piano-section {
        padding: 50px 20px;
        background: #fff;
        min-height: 100vh;
        text-align: center;
      }
      /* Container untuk piano dan falling notes */
      .piano-wrapper {
        position: relative;
        display: inline-block;
      }
      /* Piano Keys */
      .piano {
        user-select: none;
        margin-top: 250px;
      }
      .key {
        width: 60px;
        height: 200px;
        margin: 1px;
        background: white;
        border: 1px solid #ccc;
        border-radius: 4px;
        display: inline-block;
        position: relative;
        transition: background 0.1s, transform 0.1s;
        cursor: pointer;
      }
      .key.pressed {
        background: #ffd700;
        transform: translateY(4px);
        box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.2);
      }
      .key span {
        position: absolute;
        bottom: 5px;
        left: 50%;
        transform: translateX(-50%);
        font-weight: bold;
        color: #333;
      }
      /* Falling note style */
      .falling-note {
        position: absolute;
        width: 50px;
        height: 20px;
        background: rgba(255, 215, 0, 0.8);
        border-radius: 4px;
        text-align: center;
        line-height: 20px;
        font-weight: bold;
        color: #333;
        pointer-events: none;
        animation: fall 2s linear forwards;
      }
      @keyframes fall {
        0% {
          top: -30px;
          /* opacity: 1; */
        }
        100% {
          top: 220px; /* Sesuaikan dengan tinggi piano */
          /* opacity: 0; */
        }
      }
    </style>
  </head>
  <body>
    <!-- Bagian Hero -->
    <section class="hero" id="hero">
      <h1>Selamat Ulang Tahun!</h1>
      <button
        id="startButton"
        style="margin-top: 20px; padding: 10px 20px; font-size: 1rem"
      >
        Mulai
      </button>
    </section>

    <!-- Bagian Piano -->
    <section class="piano-section" id="pianoSection">
      <h2>Mainkan Piano dengan Keyboard!</h2>
      <p>Tekan tombol: A, S, D, F, J, K, L, ;</p>
      <!-- Pembungkus piano (relative) untuk falling notes -->
      <div class="piano-wrapper">
        <!-- Container Falling Notes -->
        <div id="fallingNotesContainer"></div>
        <!-- Piano Keys -->
        <div class="piano">
          <!-- Setiap key dipetakan dengan atribut data-note dan data-key -->
          <div class="key" data-note="G4" data-key="a"><span>A</span></div>
          <div class="key" data-note="A4" data-key="s"><span>S</span></div>
          <div class="key" data-note="B4" data-key="d"><span>D</span></div>
          <div class="key" data-note="C5" data-key="f"><span>F</span></div>
          <div class="key" data-note="D5" data-key="j"><span>J</span></div>
          <div class="key" data-note="E5" data-key="k"><span>K</span></div>
          <div class="key" data-note="F5" data-key="l"><span>L</span></div>
          <div class="key" data-note="G5" data-key=";"><span>;</span></div>
        </div>
      </div>
    </section>

    <script>
      // Mapping nada (frekuensi dalam Hz) untuk piano
      // const noteFrequencies = {
      //   C4: 261.63,
      //   D4: 293.66,
      //   E4: 329.63,
      //   F4: 349.23,
      //   G4: 392.0, // Tambahkan frekuensi untuk G4
      //   A4: 440.0,
      //   B4: 493.88,
      //   C5: 523.25,
      // };
      const noteFrequencies = {
        G4: 392.0,
        A4: 440.0,
        B4: 493.88,
        C5: 523.25,
        D5: 587.33,
        E5: 659.25,
        F5: 698.46,
        G5: 783.99, // Gâ€™ (lebih tinggi dari G4)
      };

      // Inisialisasi AudioContext
      const AudioContext = window.AudioContext || window.webkitAudioContext;
      const audioCtx = new AudioContext();

      // Fungsi untuk memainkan nada dengan OscillatorNode
      function playTone(frequency) {
        const oscillator = audioCtx.createOscillator();
        const gainNode = audioCtx.createGain();
        oscillator.connect(gainNode);
        gainNode.connect(audioCtx.destination);
        oscillator.type = "sine";
        oscillator.frequency.value = frequency;
        gainNode.gain.setValueAtTime(0, audioCtx.currentTime);
        gainNode.gain.linearRampToValueAtTime(1, audioCtx.currentTime + 0.01);
        oscillator.start();
        gainNode.gain.exponentialRampToValueAtTime(
          0.001,
          audioCtx.currentTime + 0.5
        );
        oscillator.stop(audioCtx.currentTime + 0.5);
      }

      // Fungsi untuk animasi key ditekan
      function animateKey(keyElement) {
        keyElement.classList.add("pressed");
        setTimeout(() => {
          keyElement.classList.remove("pressed");
        }, 150);
      }

      // Event listener untuk input keyboard
      window.addEventListener("keydown", (e) => {
        if (e.repeat) return;
        const key = e.key.toLowerCase();
        const keyElement = document.querySelector(`.key[data-key="${key}"]`);
        if (keyElement) {
          const note = keyElement.getAttribute("data-note");
          const frequency = noteFrequencies[note];
          if (frequency) {
            // Pastikan audio context aktif
            if (audioCtx.state === "suspended") {
              audioCtx.resume();
            }
            playTone(frequency);
            animateKey(keyElement);
          }
        }
      });

      // Event listener untuk klik pada key
      document.querySelectorAll(".key").forEach((keyElement) => {
        keyElement.addEventListener("click", () => {
          const note = keyElement.getAttribute("data-note");
          const frequency = noteFrequencies[note];
          if (frequency) {
            if (audioCtx.state === "suspended") {
              audioCtx.resume();
            }
            playTone(frequency);
            animateKey(keyElement);
          }
        });
      });

      // Tombol untuk memulai AudioContext
      const startButton = document.getElementById("startButton");
      startButton.addEventListener("click", () => {
        if (audioCtx.state === "suspended") {
          audioCtx.resume();
        }
        startButton.style.display = "none"; // Sembunyikan tombol setelah diklik

        // Scroll ke bagian piano
        document
          .getElementById("pianoSection")
          .scrollIntoView({ behavior: "smooth" });

        // Mulai tutorial falling notes
        tutorialSequence.forEach((noteObj) => {
          setTimeout(() => {
            createFallingNote(noteObj);
          }, noteObj.delay + 4000);
        });
      });

      // Tutorial Falling Notes untuk lagu "Happy Birthday" (versi key C)
      // Mapping: a = C4, s = D4, d = E4, f = F4, g = G4, h = A4, j = B4, k = C5
      // Versi lagu:
      // Line 1: C, C, D, C, F, E   => a, a, s, a, f, d
      // Line 2: C, C, D, C, G, F   => a, a, s, a, g, f
      // Line 3: C, C, C5, A, F, E, D   => a, a, k, h, f, d, s
      // Line 4: A, A, A, F, G, F   => h, h, h, f, g, f
      const tutorialSequence = [
        // Line 1
        { key: "a", delay: 0 },
        { key: "a", delay: 800 },
        { key: "s", delay: 1600 },
        { key: "a", delay: 2400 },
        { key: "f", delay: 3200 },
        { key: "d", delay: 4000 },
        // Line 2
        { key: "a", delay: 5000 },
        { key: "a", delay: 5800 },
        { key: "s", delay: 6600 },
        { key: "a", delay: 7400 },
        { key: "j", delay: 8200 },
        { key: "f", delay: 9000 },
        // Line 3
        { key: "a", delay: 10000 },
        { key: "a", delay: 10800 },
        { key: ";", delay: 11600 },
        { key: "k", delay: 12400 },
        { key: "f", delay: 13200 },
        { key: "d", delay: 14000 },
        { key: "s", delay: 14800 },
        // Line 4
        { key: "l", delay: 15800 },
        { key: "l", delay: 16600 },
        { key: "k", delay: 17400 },
        { key: "f", delay: 18200 },
        { key: "j", delay: 19000 },
        { key: "f", delay: 19800 },
      ];

      const FALL_DURATION = 2000; // durasi animasi jatuh (ms)

      // Fungsi untuk membuat falling note
      function createFallingNote(noteObj) {
        const { key } = noteObj;
        const keyElement = document.querySelector(`.key[data-key="${key}"]`);
        const pianoWrapper = document.querySelector(".piano-wrapper");
        if (!keyElement || !pianoWrapper) return;

        // Hitung posisi horizontal falling note berdasarkan key
        const keyRect = keyElement.getBoundingClientRect();
        const wrapperRect = pianoWrapper.getBoundingClientRect();
        const noteWidth = 50;
        const left =
          keyRect.left - wrapperRect.left + (keyRect.width - noteWidth) / 2;

        const fallingNote = document.createElement("div");
        fallingNote.classList.add("falling-note");
        fallingNote.style.left = left + "px";
        fallingNote.innerText = key.toUpperCase();

        // Tempatkan falling note ke container
        document
          .getElementById("fallingNotesContainer")
          .appendChild(fallingNote);

        // Setelah animasi selesai, hapus falling note
        setTimeout(() => {
          fallingNote.remove();
          // Simulasi animasi key dan mainkan nada
          const note = keyElement.getAttribute("data-note");
          // const frequency = noteFrequencies[note];
          // if (frequency) {
          //   if (audioCtx.state === "suspended") {
          //     audioCtx.resume();
          //   }
          //   playTone(frequency);
          //   animateKey(keyElement);
          // }
        }, FALL_DURATION);
      }
    </script>
  </body>
</html>
